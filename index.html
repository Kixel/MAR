<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Carter One">
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css">
    -->

    <link rel="stylesheet" href="./MAR.css">
    <script src="./scripts/jquery.min.js"></script>
    <script src="./scripts/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="./scripts/jquery-ui.css">
    
    <script src="https://randojs.com/2.0.0.js"></script>
    <script src="scripts/jquery.table.transpose.min.js"></script>
    <title>Multi-Attack-Resolver</title>
    <script>
        (function ($) {
            $.fn.styleTable = function (options) {
                var defaults = {
                    css: 'ui-styled-table'
                };
                options = $.extend(defaults, options);
                return this.each(function () {
                    $this = $(this);
                    $this.addClass(options.css);
                    $this.on('mouseover mouseout', 'tbody tr', function (event) {
                        $(this).children().toggleClass("ui-state-hover",
                            event.type == 'mouseover');
                    });
                    $this.find("th").addClass("ui-state-default");
                    $this.find("td").addClass("ui-widget-content");
                    $this.find("tr:last-child").addClass("last-child");
                });
            };
        })(jQuery);
    </script>
    <script>
        const emotes = {
            manyshot: "🏹",
            overfifty: "💢",
            overhundred: "💥",
            twofifty: "💀",
            normal: "🗡",
            critical: "⚔",
            sixtynine: "👌",
            fortytwo: "🤖",
            underten: "💩",
            fivehundred: "👽",
            sixsixsix: "👹",
            thousand: "🤡"
        }
        const greencolor = [0, 192, 64];
        const redcolor = [192, 0, 32]
        var defaultload = "default";
        if(document.location.hostname == "") {
            var defaultload = "sven1";
        } 
        var wassingleattack = false;
        var buttonsareloaded = false;
        const autodiceroll = true;
        const d20selector = '<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option>'
        const damagetypes_full = ["physical", "force", "psy"];
        const damagetypes_dice = ["sonic", "storm", "acid", "fire", "ice", "good", "evil", "other"];
        const damagetypes_fix = ["other"];
        const damagetypes_hidden_dice = ["precision", "sneak"];
        const damagetypes_hidden_fix = ["hammerthegap"];
        const damagedice = ["", "1d6", "2d6", "1d8", "2d8", "1d10", "1d12", "1d4", "2d4", "3d4", "4d4", "5d4", "3d6", "4d6", "5d6", "6d6", "7d6", "8d6", "9d6", "10d6"];
        const damagetype_aliases = {
            "physical": "Physical",
            "force": "Force",
            "psy": "Psychic",
            "sonic": "Sonic",
            "storm": "Electric",
            "acid": "Acid",
            "fire": "Fire",
            "ice": "Ice",
            "good": "Holy",
            "evil": "Unholy",
            "other": "Misc.",
            "precision": "Precision",
            "sneak": "Sneak",
            "hammerthegap": "HTG"
        }
        const damagetype_emotes = {
            "physical": "⚔",
            "force": "✨",
            //"psy": "🔮",
            "psy": "🧠",
            "sonic": "🎶",
            "storm": "⚡",
            "acid": "☣",
            "fire": "🔥",
            "ice": "🧊",
            "good": "😇",
            "evil": "👿",
            "other": "⚠",
            "precision": "🎯",
            "hammerthegap": "🔨"
            //"sneak": "👁️‍🗨️"
        }
        const presetfiles = ["sven1.json", "dinh1.json", "alessia1.json", "andi1.json", "Hu-Li_NEU.json", "Psychic-Barrage-18.json", "Corrin-18-Fireball-SoB.json"];
        const presets = {
            "default": {
                name: "Default",
                items: {
                    "mainattackchain": "6,1",
                    "offattackchain": "",
                    "maincritroll": 20,
                    "offcritroll": 20,
                    "maincritmult": 1,
                    "offcritmult": 1,
                    "critbonus": "",
                    "main_physical_dice": "",
                    "main_physical_fix": "",
                    "main_force_dice": "",
                    "main_force_fix": "",
                    "main_psy_dice": "",
                    "main_psy_fix": "",
                    "main_sonic_dice": "",
                    "main_storm_dice": "",
                    "main_acid_dice": "",
                    "main_fire_dice": "",
                    "main_ice_dice": "",
                    "main_good_dice": "",
                    "main_evil_dice": "",
                    "main_other_dice": "",
                    "main_other_fix": "",
                    "maincrit_physical_dice": "",
                    "maincrit_physical_fix": "",
                    "maincrit_force_dice": "",
                    "maincrit_force_fix": "",
                    "maincrit_psy_dice": "",
                    "maincrit_psy_fix": "",
                    "maincrit_sonic_dice": "",
                    "maincrit_storm_dice": "",
                    "maincrit_acid_dice": "",
                    "maincrit_fire_dice": "",
                    "maincrit_ice_dice": "",
                    "maincrit_good_dice": "",
                    "maincrit_evil_dice": "",
                    "maincrit_other_dice": "",
                    "maincrit_other_fix": "",
                    "off_physical_dice": "",
                    "off_physical_fix": "",
                    "off_force_dice": "",
                    "off_force_fix": "",
                    "off_psy_dice": "",
                    "off_psy_fix": "",
                    "off_sonic_dice": "",
                    "off_storm_dice": "",
                    "off_acid_dice": "",
                    "off_fire_dice": "",
                    "off_ice_dice": "",
                    "off_good_dice": "",
                    "off_evil_dice": "",
                    "off_other_dice": "",
                    "off_other_fix": "",
                    "offcrit_physical_dice": "",
                    "offcrit_physical_fix": "",
                    "offcrit_force_dice": "",
                    "offcrit_force_fix": "",
                    "offcrit_psy_dice": "",
                    "offcrit_psy_fix": "",
                    "offcrit_sonic_dice": "",
                    "offcrit_storm_dice": "",
                    "offcrit_acid_dice": "",
                    "offcrit_fire_dice": "",
                    "offcrit_iced_ice": "",
                    "offcrit_good_dice": "",
                    "offcrit_evil_dice": "",
                    "offcrit_other_dice": "",
                    "offcrit_other_fix": ""
                }
            } 
        };
    
        for(let presetfile of presetfiles) {
            try {

                $.ajax({
                    url: "./presets/" + presetfile,
                    dataType: "json",
                    success: function(data) {
                        let filename = presetfile.split(".")[0];
                        console.log(data);
                        presets[filename] = data;
                        addAllButtons();
                    },
                    error: function(stuff, txtstuff, errorstuff) {
                        console.log("error loading "+presetfile);
                    }
                });
            } catch(err) {
                console.log("some error");
            }
        }
    </script>
    <script>
        function getAllOfDamage(partialkey) {
            let output = [];
            $("input[id*='"+partialkey+"']").each(function(i, obj) {
                output.push($(obj).val());
            });
            $("select[id*='"+partialkey+"']").each(function(i, obj) {
                output.push($(obj).val());
            });
            $("span[id*='"+partialkey+"']").each(function(i, obj) {
                output.push(obj.innerHTML);
            })
            return output;
        }
        function getSetupDamage(partialkey) {
            let output = [];
            $("input[id*='"+partialkey+"']").each(function(i, obj) {
                output.push($(obj).val());
            });
            $("select[id*='"+partialkey+"']").each(function(i, obj) {
                output.push($(obj).val());
            });
            return output;
        }
        function getModifyDamage(partialkey) {
            let output = [];
            $("span[id*='"+partialkey+"']").each(function(i, obj) {
                output.push(obj.innerHTML);
            })
            return output;
        }
        function isDice(input) {
            let reg = /^\d+d\d+/
            return reg.test(input);
        }
        function getAllOfModifier(partialkey) {
            let output = [];
            $("span[id*='"+partialkey+"']").each(function(i, obj) {
                output.push(obj.innerHTML);
            })
            return output;
        }
        function damagebasedemotes(dmg, nopoo=false, factor=1) {
            let hitemotes = ""
            if(dmg >= 50*factor) {
                hitemotes += emotes.overfifty;
            }
            if(dmg >= 100*factor) {
                hitemotes += emotes.overhundred;
            }
            if(dmg >= 250*factor) {
                hitemotes += emotes.twofifty;
            }
            if(dmg == 42) {
                hitemotes += emotes.fortytwo;
            }
            if(dmg == 69) {
                hitemotes += emotes.sixtynine;
            }
            if(dmg < 10*factor && !nopoo) {
                hitemotes += emotes.underten;
            }
            if(dmg >= 500*factor) {
                hitemotes += emotes.fivehundred;
            }
            if(dmg >= 1000*factor) {
                hitemotes += emotes.thousand;
            }
            if(dmg == 666) {
                hitemotes += emotes.sixsixsix;
            }
            return hitemotes;
        }
        function randomdicenumber(max) {
            //return Math.floor(Math.random() * max) + 1;
            return rando(1,max);
        }
        function sumOfArray(inputarray) {
            return inputarray.reduce((a, b) => parseFloat(a) + parseFloat(b), 0);
        }
        function rolldice(dicesimple) {
            let parts = dicesimple.split("d");
            var output = [];
            for (let i = 0; i < parts[0]; i++) {
                output.push(randomdicenumber(parseInt(parts[1])));
            }
            return output;
        }
        function verboseDamageString(numbersarr, verbosearr) {
            let outputstring = "";
            //console.log(numbersarr, verbosearr);
            for(let i = 0; i < numbersarr.length; i++) {
                if(numbersarr[i] instanceof Array) {
                    outputstring += "[" + verbosearr[i] + ": ";
                    for(let el of numbersarr[i]) {
                        outputstring += el+", ";
                    }
                    outputstring = outputstring.substring(0, outputstring.length-2);
                    outputstring += "], ";
                } else {
                    outputstring += numbersarr[i]+", ";
                }
                //console.log(outputstring);
            }
            //console.log(outputstring);
            return outputstring.substring(0, outputstring.length-2);
        }
        function multiplydice(dicesimple, multiplier) {
            let parts = dicesimple.split("d");
            let firstnumber = parseInt(parts[0]) * parseInt(multiplier);
            return firstnumber + "d" + parts[1];
        }
        function getDiceSelector(classname) {
            let output = '<select name="' + classname + '" id="' + classname + '">';
            for (let damagedie of damagedice) {
                output += '<option value="' + damagedie + '">' + damagedie + '</option>';
            }
            output += '</select>';
            return output;
        }
        function filterArray(inarray, filter) {
            let outputarray = [];
            for(let inar of inarray) {
                if(inar != filter) {
                    outputarray.push(inar);
                }
            }
            return outputarray;
        }
        function colorscale(colorone, colortwo, percent) {
            let r = colorone[0]*percent + colortwo[0]*(1-percent);
            let g = colorone[1]*percent + colortwo[1]*(1-percent);
            let b = colorone[2]*percent + colortwo[2]*(1-percent);
            return [r,g,b];
        }
    </script>
</head>
<body>
    <div class="header">
        <h1 class="totaltitle">Pathfinder Multi Attack Resolver</h1>
        <h4 class="totalsub">... for lazy people!</h4>
    </div>
    <div class="tabcontainer">
        <div id="maintabs">
            <ul>
                <li class="leftli"><a href="#setuptab">SETUP</a></li>
                <li><a href="#modifytab">MODIFY</a></li>
                <li><a href="#resolvetab">RESOLVE</a></li>
                <li><a href="#resulttab">RESULT</a></li>
            </ul>
            <div id="setuptab">
                <div class="semiaccordion">
                    <h3>Presets</h3>
                    <div id="presetcontainer">
                        
                    </div>
                </div>
                <div class="semiaccordion">
                    <h3>Load/Save</h3>
                    <div id="loadsavecontainer">
                        <div id="loadbox">
                            <input type="file" id="presetinput" />
                            <button onclick="loadpreset('loadedfromfile');" id="presetinputbutton" disabled>LOAD FILE</button>
                        </div>
                        <div id="savebox">
                            <input type="text" id="outputpresetname" placeholder="Preset name"  />
                            <button id="outputpresetbutton" onclick="savetofile()" disabled>SAVE TO FILE</button>
                        </div>
                    </div>
                </div>
                <div class="semiaccordion">
                    <h3>Basic setup</h3>
                    <div>
                        <table class="fullwidth" id="basicsetuptable">
                            <tr>
                                <td>
                                    <label for="mainattackchain">Main attack chain</label>
                                </td>
                                <td>
                                    <input id="mainattackchain" value="1" />
                                </td>
                                <td></td>
                                <td>
                                    <label for="mainattackchain">Comma separated numbers [16,11,6]</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label for="offattackchain">Offhand attack chain</label>
                                </td>
                                <td>
                                    <input id="offattackchain" />
                                </td>
                                <td></td>
                                <td>
                                    <label for="offattackchain">Comma separated numbers [16,11,6] or empty []</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label for="maincritroll">Main crit roll</label>
                                </td>
                                <td>
                                    <div id="maincritroll"></div>
                                    <script>
                                        $("#maincritroll").slider({
                                            min: 1,
                                            max: 20,
                                            step: 1,
                                            range: "max",
                                            value: 20,
                                            slide: function (event, ui) {
                                                $("#maincritrollpreview").text(ui.value);
                                            },
                                            change: function (event, ui) {
                                                $("#maincritrollpreview").text(ui.value);
                                            }
                                        });
                                    </script>
                                </td>
                                <td>
                                    <label for="maincritroll" id="maincritrollpreview">20</label>
                                </td>
                                <td>
                                    <label for="maincritroll">Select value from 1-20</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label for="offcritroll">Offhand crit roll</label>
                                </td>
                                <td>
                                    <div id="offcritroll"></div>
                                    <script>
                                        $("#offcritroll").slider({
                                            min: 1,
                                            max: 20,
                                            step: 1,
                                            range: "max",
                                            value: 20,
                                            slide: function (event, ui) {
                                                $("#offcritrollpreview").text(ui.value);
                                            },
                                            change: function (event, ui) {
                                                $("#offcritrollpreview").text(ui.value);
                                            }
                                        });
                                    </script>
                                </td>
                                <td>
                                    <label for="offcritroll" id="offcritrollpreview">20</label>
                                </td>
                                <td>
                                    <label for="offcritroll">Select value from 1-20</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label for="maincritmult">Main crit multiplier</label>
                                </td>
                                <td>
                                    <div id="maincritmult"></div>
                                    <script>
                                        $("#maincritmult").slider({
                                            min: 1,
                                            max: 6,
                                            step: 1,
                                            range: "min",
                                            value: 1,
                                            slide: function (event, ui) {
                                                $("#maincritmultpreview").text(ui.value+1);
                                            },
                                            change: function (event, ui) {
                                                $("#maincritmultpreview").text(ui.value+1);
                                            }
                                        });
                                    </script>
                                </td>
                                <td>
                                    <label for="maincritmult" id="maincritmultpreview">2</label>
                                </td>
                                <td>
                                    <label for="maincritmult">Only used for multiplying damage from the Modify tab</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label for="offcritmult">Offhand crit multiplier</label>
                                </td>
                                <td>
                                    <div id="offcritmult"></div>
                                    <script>
                                        $("#offcritmult").slider({
                                            min: 1,
                                            max: 6,
                                            step: 1,
                                            range: "min",
                                            value: 1,
                                            slide: function (event, ui) {
                                                $("#offcritmultpreview").text(ui.value+1);
                                            },
                                            change: function (event, ui) {
                                                $("#offcritmultpreview").text(ui.value+1);
                                            }
                                        });
                                    </script>
                                </td>
                                <td>
                                    <label for="offcritmult" id="offcritmultpreview">2</label>
                                </td>
                                <td>
                                    <label for="offcritmult">Only used for multiplying damage from the Modify tab</label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label for="critbonus">Crit confirm bonus</label>
                                </td>
                                <td>
                                    <input id="critbonus" type="number" />
                                </td>
                                <td></td>
                                <td>
                                    <label for="critbonus">Any number [3] or nothing []</label>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="semiaccordion">
                    <h3>Damage setup</h3>
                    <div>
                        <table class="fullwidth" id="damagesetup">
                            <thead>
                                <tr>
                                    <th>Attack</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr id="main">
                                    <td title="Damage components with a normal attack with your mainhand weapon.">Mainhand</th>
                                </tr>
                                <tr id="maincrit">
                                    <td title="Damage components added to your normal damage on a crit with your mainhand weapon.">Main Crit</th>
                                </tr>
                                <tr id="off">
                                    <td title="Damage components with a normal attack with your offhand weapon. Has no effect if no offhand attack chain is set.">Offhand</th>
                                </tr>
                                <tr id="offcrit">
                                    <td title="Damage components added to your normal damage on a crit with your mainhand weapon. Has no effect if no offhand attack chain is set.">Off Crit</th>
                                </tr>
                            </tbody>
                        </table>
                        <br />
                        <script>
                            $("#damagesetup").tooltip();
                            for (let dtfull of damagetypes_full) {
                                $("#damagesetup thead tr").append('<th>' + damagetype_aliases[dtfull] + '</th><th></th>');
                                $("#damagesetup tbody").find('tr').each(function () {
                                    let rkey = $(this).attr('id') + "_" + dtfull;
                                    $(this).append('<td>' + getDiceSelector(rkey + "_dice") + '</td><td><input type="number" id="' + rkey + "_fix"+'" /></td>');
                                })
                            }
                            for (let dtfull of damagetypes_dice) {
                                $("#damagesetup thead tr").append('<th>' + damagetype_aliases[dtfull] + '</th>');
                                $("#damagesetup tbody").find('tr').each(function () {
                                    let rkey = $(this).attr('id') + "_" + dtfull;
                                    $(this).append('<td>' + getDiceSelector(rkey + "_dice") + '</td>');
                                })
                            }
                            for (let dtfull of damagetypes_fix) {
                                $("#damagesetup thead tr").append('<th>' + damagetype_aliases[dtfull] + '</th>');
                                $("#damagesetup tbody").find('tr').each(function () {
                                    let rkey = $(this).attr('id') + "_" + dtfull;
                                    $(this).append('<td><input type="number" id="' + rkey + "_fix" +'" /></td>');
                                })
                            }
                            //$("#damagesetup").styleTable();
                        </script>
                    </div>
                </div>
                
                <script>
                    function updateloadbutton() {
                        let nn = $("#outputpresetname").val();
                        let nnn = (nn == "");
                        $("#outputpresetbutton").button("option", "disabled",  nnn);
                    }
                    $("#outputpresetname").on("change keydown paste input", updateloadbutton);
                    function loadpreset(key) {
                        //TODO
                        if(key in presets) {
                            console.log("Loading preset "+key+", named "+presets[key].name);
                            for(const[presetkey, presetvalue] of Object.entries(presets[key].items)) {
                                if(presetkey == "maincritroll" || presetkey == "offcritroll" || presetkey == "maincritmult" || presetkey == "offcritmult") {
                                    $("#"+presetkey).slider("value", presetvalue);
                                } else {
                                    $("#"+presetkey).val(presetvalue);
                                }
                            }
                            
                        } else {
                            console.log("moep");
                        }
                    }
                    
                    function savetofile() {
                        let outputname = $("#outputpresetname").val();
                        if(outputname != "") {
                            let listofitems = ["mainattackchain", "offattackchain", "maincritroll", "offcritroll", "critbonus", "maincritmult", "offcritmult"];
                            $("#damagesetup select, #damagesetup input").each(function() {
                                listofitems.push($(this).attr("id"));
                            })
                            let newfile = {
                                name: $("#outputpresetname").val(),
                                items: {
                                }
                            }
                            for(let newitem of listofitems) {
                                let aaaa = "";
                                if(newitem == "maincritroll" || newitem == "offcritroll" || newitem == "maincritmult" || newitem == "offcritmult") {
                                    aaaa = $("#"+newitem).slider("value");
                                } else {
                                    aaaa = $("#"+newitem).val();
                                }
                                newfile.items[newitem] = aaaa;
                            }
                            let filename = outputname.replace(/[/\\?%*:|"äöü <>]/g, '-') + ".json";
                            //console.log(filename);
                            //console.log(newfile);
                            const a = document.createElement("a");
                            a.href = URL.createObjectURL(new Blob([JSON.stringify(newfile, null, 2)], {
                                type: "text/plain"
                            }));
                            a.setAttribute("download", filename);
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        }
                    }
                    function saveandcontinue() {
                        $("#maintabs").tabs({active: 1});
                    }
                    function readSingleFile(e) {
                        var file = e.target.files[0];
                        if (!file) {
                            return;
                        }
                        $("#presetinputbutton").button("option", "disabled",  false);
                        var reader = new FileReader();
                        reader.onload = function(e) {
                            var contents = e.target.result;
                            //console.log(contents);
                            const tojson = JSON.parse(contents);
                            presets["loadedfromfile"] = tojson;
                        };
                        reader.readAsText(file);
                    }
                    $("#presetinput").change(readSingleFile);
                </script>
                <button class="fullwidth topmargin" onclick="saveandcontinue();">Continue</button>
            </div>
            <div id="modifytab">
                <!--<div class="semiaccordion">
                    <h3>Combat Round Modifiers</h3>
                    <div>-->
                        <table id="roundmods" class="fullwidth">
                            <thead>
                                <tr>
                                    <th style="text-align: center;">✔</th><th>Modifier</th><th>Parameters/Effects</th><th colspan="2">Preview</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th colspan="5">General</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="inspirecourage_active" /></td>
                                    <td><label for="inspirecourage_active">Inspire Courage</label></td>
                                    <td><div id="inspirecourage_slider"></div></td>
                                    <td id="inspirecourage_preview">1</td>
                                    <td class="hidey">
                                        <script>
                                            $("#inspirecourage_slider").slider({
                                                min: 1,
                                                max: 4,
                                                step: 1,
                                                slide: function(event, ui) {
                                                    $("#inspirecourage_preview").text(ui.value);
                                                },
                                                change: function(event, ui) {
                                                    $("#inspirecourage_preview").text(ui.value);
                                                    updateAll();
                                                }
                                            });
                                            function inspirecourage_update() {
                                                if ($("#inspirecourage_active").prop('checked')) {
                                                    let buffval = $("#inspirecourage_slider").slider("value")
                                                    $("#inspirecourage_AT").text(buffval);
                                                    $("#inspirecourage_bonus_main_physical_fix").text(buffval);
                                                    $("#inspirecourage_bonus_maincrit_physical_fix").text(buffval);
                                                    $("#inspirecourage_bonus_off_physical_fix").text(buffval);
                                                    $("#inspirecourage_bonus_offcrit_physical_fix").text(buffval);
                                                    
                                                } else {
                                                    $("#inspirecourage_AT").text("0");
                                                    //$("#inspirecourage_BONUSFIX_physical").text("0");
                                                    $("#inspirecouragesonic_active").prop('checked', false);
                                                    $("#inspirecourage_bonus_main_physical_fix").text("");
                                                    $("#inspirecourage_bonus_maincrit_physical_fix").text("");
                                                    $("#inspirecourage_bonus_off_physical_fix").text("");
                                                    $("#inspirecourage_bonus_offcrit_physical_fix").text("");
                                                }
                                            };
                                        </script>
                                        <span id="inspirecourage_AT">0</span><span id="inspirecourage_bonus_main_physical_fix"></span><span id="inspirecourage_bonus_maincrit_physical_fix"></span><span id="inspirecourage_bonus_off_physical_fix"></span><span id="inspirecourage_bonus_offcrit_physical_fix"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="inspirecouragesonic_active" /></td>
                                    <td><label for="inspirecouragesonic_active">Inspire Courage: Extra Sonic Damage</label></td>
                                    <td>+1d6 Sonic damage</td>
                                    <td id="inspirecouragesonic_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function inspirecouragesonic_update() {
                                                if ($("#inspirecouragesonic_active").prop('checked')) {
                                                    $("#inspirecouragesonic_bonus_main_sonic_dice").text("1d6");
                                                    $("#inspirecouragesonic_bonus_off_sonic_dice").text("1d6");
                                                } else {
                                                    $("#inspirecouragesonic_bonus_main_sonic_dice").text("");
                                                    $("#inspirecouragesonic_bonus_off_sonic_dice").text("");
                                                }
                                            }
                                        </script>
                                        <span id="inspirecouragesonic_bonus_main_sonic_dice"></span><span id="inspirecouragesonic_bonus_off_sonic_dice"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="haste_active" /></td>
                                    <td><label for="haste_active">Haste</label></td>
                                    <td>+1 AT, +1 Extra Attack on highest BAB</td>
                                    <td id="haste_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function haste_update() {
                                                if ($("#haste_active").prop('checked')) {
                                                    $("#haste_EXTRAAT").text("1");
                                                    $("#haste_AT").text("1");
                                                } else {
                                                    $("#haste_EXTRAAT").text("0");
                                                    $("#haste_AT").text("0");
                                                }                                            
                                            }
                                        </script>
                                        <span id="haste_AT">0</span><span id="haste_EXTRAAT">0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="hammerthegap_active" /></td>
                                    <td><label for="hammerthegap_active">Hammer the Gap</label></td>
                                    <td>Increased extra damage for each consecutive hit</td>
                                    <td id="hammerthegap_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function hammerthegap_update() {
                                                if ($("#hammerthegap_active").prop('checked')) {
                                                    $("#hammerthegap_HAMMERTHEGAP").text("1");
                                                    $("#hammerthegap_bonus_main_hammerthegap_fix").text("1");
                                                    $("#hammerthegap_bonus_off_hammerthegap_fix").text("1");
                                                    
                                                } else {
                                                    $("#hammerthegap_HAMMERTHEGAP").text("0");
                                                    $("#hammerthegap_bonus_main_hammerthegap_fix").text("");
                                                    $("#hammerthegap_bonus_off_hammerthegap_fix").text("");
                                                }                                            
                                            }
                                        </script>
                                        <span id="hammerthegap_HAMMERTHEGAP">0</span><span id="hammerthegap_bonus_main_hammerthegap_fix"></span><span id="hammerthegap_bonus_off_hammerthegap_fix"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <th colspan="5">Class-specific</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="mobilefighter_active" /></td>
                                    <td><label for="mobilefighter_active">Mobile Fighter</label></td>
                                    <td><div id="mobilefighter_slider"></div></td>
                                    <td id="mobilefighter_preview">1</td>
                                    <td class="hidey">
                                        <script>
                                            $("#mobilefighter_slider").slider({
                                                min: 1,
                                                max: 5,
                                                step: 1,
                                                slide: function(event, ui) {
                                                    $("#mobilefighter_preview").text(ui.value);
                                                },
                                                change: function(event, ui) {
                                                    $("#mobilefighter_preview").text(ui.value);
                                                    updateAll();
                                                }
                                            });
                                            function mobilefighter_update() {
                                                if ($("#mobilefighter_active").prop('checked')) {
                                                    let buffval = $("#mobilefighter_slider").slider("value")
                                                    $("#mobilefighter_AT").text(buffval);
                                                    $("#mobilefighter_BONUSFIX_physical").text(buffval);
                                                    $("#mobilefighter_bonus_main_physical_fix").text(buffval);
                                                    $("#mobilefighter_bonus_maincrit_physical_fix").text(buffval);
                                                    $("#mobilefighter_bonus_off_physical_fix").text(buffval);
                                                    $("#mobilefighter_bonus_offcrit_physical_fix").text(buffval);
                                                } else {
                                                    $("#mobilefighter_AT").text("0");
                                                    $("#mobilefighter_bonus_main_physical_fix").text("");
                                                    $("#mobilefighter_bonus_maincrit_physical_fix").text("");
                                                    $("#mobilefighter_bonus_off_physical_fix").text("");
                                                    $("#mobilefighter_bonus_offcrit_physical_fix").text("");
                                                }
                                            };
                                        </script>
                                        <span id="mobilefighter_AT">0</span><span id="mobilefighter_bonus_main_physical_fix"></span><span id="mobilefighter_bonus_maincrit_physical_fix"></span><span id="mobilefighter_bonus_off_physical_fix"></span><span id="mobilefighter_bonus_offcrit_physical_fix"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="mutagen_active" /></td>
                                    <td><label for="mutagen_active">Mutagen</label></td>
                                    <td>
                                        <select name="mutagen_selector" id="mutagen_selector">
                                            <option value="a0d0">None</option>
                                            <optgroup label="Mutagen">
                                                <option value="a2d0">Attack +2</option>
                                                <option value="a0d2">Damage +2</option>
                                                <option value="a2d2">Attack +2, Damage +2</option>
                                            </optgroup>
                                            <optgroup label="Greater Mutagen">
                                                <option value="a2d3">Attack +2, Damage +3</option>
                                                <option value="a3d0">Attack +3</option>
                                                <option value="a0d3">Damage +3</option>
                                                <option value="a3d2">Attack +3, Damage +2</option>
                                                <option value="a3d3">Attack +3, Damage +3</option>
                                            </optgroup>
                                            <optgroup label="Grand Mutagen">
                                                <option value="a2d4">Attack +2, Damage +4</option>
                                                <option value="a3d4">Attack +3, Damage +4</option>
                                                <option value="a4d2">Attack +4, Damage +2</option>
                                                <option value="a4d3">Attack +4, Damage +3</option>
                                                <option value="a4d4">Attack +4, Damage +4</option>
                                            </optgroup>
                                        </select>        
                                    </td>
                                    <td id="mutagen_preview"></td>
                                    <td class="hidey">
                                        <script>
                                            $("#mutagen_selector").selectmenu({
                                                change: function(event, ui) {
                                                    updateAll();
                                                }
                                            }).addClass( "overflow" );
                                            function mutagen_update() {
                                                if ($("#mutagen_active").prop('checked')) {
                                                    let buffval = $("#mutagen_selector").val();
                                                    $("#mutagen_AT").text(buffval.substring(1,2));
                                                    $("#mutagen_bonus_main_physical_fix").text(buffval.substring(3));
                                                    $("#mutagen_bonus_maincrit_physical_fix").text(buffval.substring(3));
                                                    $("#mutagen_bonus_off_physical_fix").text(buffval.substring(3));
                                                    $("#mutagen_bonus_offcrit_physical_fix").text(buffval.substring(3));
                                                    
                                                } else {
                                                    $("#mutagen_AT").text("0");
                                                    $("#mutagen_bonus_main_physical_fix").text("");
                                                    $("#mutagen_bonus_maincrit_physical_fix").text("");
                                                    $("#mutagen_bonus_off_physical_fix").text("");
                                                    $("#mutagen_bonus_offcrit_physical_fix").text("");
                                                }
                                            };
                                        </script>
                                        <span id="mutagen_AT">0</span><span id="mutagen_bonus_main_physical_fix"></span><span id="mutagen_bonus_maincrit_physical_fix"></span><span id="mutagen_bonus_off_physical_fix"></span><span id="mutagen_bonus_offcrit_physical_fix"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="sneak_active" /></td>
                                    <td><label for="sneak_active">Sneak Attack</label></td>
                                    <td><div id="sneak_slider"></div></td>
                                    <td id="sneak_preview">1d6</td>
                                    <td class="hidey">
                                        <script>
                                            $("#sneak_slider").slider({
                                                min: 1,
                                                max: 20,
                                                step: 1,
                                                slide: function(event, ui) {
                                                    $("#sneak_preview").text(ui.value+"d6");
                                                },
                                                change: function(event, ui) {
                                                    $("#sneak_preview").text(ui.value+"d6");
                                                    updateAll();
                                                }
                                            });
                                            function sneak_update() {
                                                if ($("#sneak_active").prop('checked')) {
                                                    let buffval = $("#sneak_slider").slider("value")
                                                    //$("#sneak_BONUSDICE_precision").text(buffval+"d6");
                                                    $("#sneak_bonus_main_precision_dice").text(buffval+"d6");
                                                    $("#sneak_bonus_off_precision_dice").text(buffval+"d6");
                                                } else {
                                                    //$("#sneak_BONUSDICE_precision").text("0d6");
                                                    $("#sneak_bonus_main_precision_dice").text("");
                                                    $("#sneak_bonus_off_precision_dice").text("");
                                                    $("#sneak2bonus_active").prop('checked', false);
                                                    $("#sneak3bonus_active").prop('checked', false);
                                                }
                                            };
                                        </script>
                                        <span id="sneak_bonus_main_precision_dice"></span><span id="sneak_bonus_off_precision_dice"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="sneak2bonus_active" /></td>
                                    <td><label for="sneak2bonus_active">Sneak Attack: 1 -> 2</label></td>
                                    <td>All 1s on the d6 are counted as 2s</td>
                                    <td id="sneak2bonus_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function sneak2bonus_update() {
                                                if ($("#sneak2bonus_active").prop('checked')) {
                                                    $("#sneak2bonus_SNEAKTWO").text("1");
                                                    $("#sneak2bonus_AT").text("-2");
                                                    
                                                } else {
                                                    $("#sneak2bonus_SNEAKTWO").text("0");
                                                    $("#sneak2bonus_AT").text("0");
                                                    $("#sneak3bonus_active").prop('checked', false);
                                                }                                            
                                            }
                                        </script>
                                        <span id="sneak2bonus_SNEAKTWO">0</span><span id="sneak2bonus_AT">0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="sneak3bonus_active" /></td>
                                    <td><label for="sneak3bonus_active">Sneak Attack: 1,2 -> 3</label></td>
                                    <td>All 1s and 2s on the d6 are counted as 3s</td>
                                    <td id="sneak3bonus_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function sneak3bonus_update() {
                                                if ($("#sneak3bonus_active").prop('checked')) {
                                                    $("#sneak3bonus_SNEAKTHREE").text("1");
                                                    
                                                } else {
                                                    $("#sneak3bonus_SNEAKTHREE").text("0");
                                                    
                                                }                                            
                                            }
                                        </script>
                                        <span id="sneak3bonus_SNEAKTHREE">0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <th colspan="5">Ranged</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="pointblank_active" /></td>
                                    <td><label for="pointblank_active">Point-Blank Shot</label></td>
                                    <td>+1 AT, +1 Damage within 30ft</td>
                                    <td id="pointblank_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function pointblank_update() {
                                                if ($("#pointblank_active").prop('checked')) {
                                                    $("#pointblank_AT").text("1");
                                                    $("#pointblank_bonus_main_physical_fix").text("1");
                                                    $("#pointblank_bonus_maincrit_physical_fix").text("1");
                                                    $("#pointblank_bonus_off_physical_fix").text("1");
                                                    $("#pointblank_bonus_offcrit_physical_fix").text("1");
                                                } else {
                                                    $("#pointblank_AT").text("0");
                                                    $("#pointblank_bonus_main_physical_fix").text("");
                                                    $("#pointblank_bonus_maincrit_physical_fix").text("");
                                                    $("#pointblank_bonus_off_physical_fix").text("");
                                                    $("#pointblank_bonus_offcrit_physical_fix").text("");
                                                    
                                                }                                            
                                            }
                                        </script>
                                        <span id="pointblank_AT">0</span><span id="pointblank_bonus_main_physical_fix"></span><span id="pointblank_bonus_maincrit_physical_fix"></span><span id="pointblank_bonus_off_physical_fix"></span><span id="pointblank_bonus_offcrit_physical_fix"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="rapidshot_active" /></td>
                                    <td><label for="rapidshot_active">Rapid Shot</label></td>
                                    <td>-2 AT, one extra Attack at highest BAB</td>
                                    <td id="rapidshot_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function rapidshot_update() {
                                                if ($("#rapidshot_active").prop('checked')) {
                                                    $("#rapidshot_AT").text("-2");
                                                    $("#rapidshot_EXTRAAT").text("1");
                                                } else {
                                                    $("#rapidshot_AT").text("0");
                                                    $("#rapidshot_EXTRAAT").text("0");
                                                }                                            
                                            }
                                        </script>
                                        <span id="rapidshot_AT">0</span><span id="rapidshot_EXTRAAT">0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="manyshot_active" /></td>
                                    <td><label for="manyshot_active">Manyshot</label></td>
                                    <td>Fire two arrows with your first ranged full-round attack shot</td>
                                    <td id="manyshot_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function manyshot_update() {
                                                if ($("#manyshot_active").prop('checked')) {
                                                    $("#manyshot_MANYSHOT").text("1");
                                                    
                                                } else {
                                                    $("#manyshot_MANYSHOT").text("0");
                                                    
                                                }                                            
                                            }
                                        </script>
                                        <span id="manyshot_MANYSHOT">0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="deadlyaim_active" /></td>
                                    <td><label for="deadlyaim_active">Deadly Aim</label></td>
                                    <td><div id="deadlyaim_slider"></div></td>
                                    <td id="deadlyaim_preview">-0/+0</td>
                                    <td class="hidey">
                                        <script>
                                            $("#deadlyaim_slider").slider({
                                                min: 0,
                                                max: 6,
                                                step: 1,
                                                slide: function(event, ui) {
                                                    let newval = ui.value;
                                                    $("#deadlyaim_preview").text("-"+newval+"/+"+newval*2);
                                                },
                                                change: function(event, ui) {
                                                    let newval = ui.value;
                                                    $("#deadlyaim_preview").text("-"+newval+"/+"+newval*2);
                                                    updateAll();
                                                }
                                            });
                                            function deadlyaim_update() {
                                                if ($("#deadlyaim_active").prop('checked')) {
                                                    let buffval = $("#deadlyaim_slider").slider("value")
                                                    $("#deadlyaim_AT").text("-"+buffval);
                                                    $("#deadlyaim_bonus_main_physical_fix").text(buffval*2);
                                                    $("#deadlyaim_bonus_maincrit_physical_fix").text(buffval*2);
                                                    $("#deadlyaim_bonus_off_physical_fix").text(buffval*2);
                                                    $("#deadlyaim_bonus_offcrit_physical_fix").text(buffval*2);
                                                } else {
                                                    $("#deadlyaim_AT").text("0");
                                                    $("#deadlyaim_bonus_main_physical_fix").text("");
                                                    $("#deadlyaim_bonus_maincrit_physical_fix").text("");
                                                    $("#deadlyaim_bonus_off_physical_fix").text("");
                                                    $("#deadlyaim_bonus_offcrit_physical_fix").text("");
                                                    
                                                }
                                            };
                                        </script>
                                        <span id="deadlyaim_AT">0</span><span id="deadlyaim_bonus_main_physical_fix"></span><span id="deadlyaim_bonus_maincrit_physical_fix"></span><span id="deadlyaim_bonus_off_physical_fix"></span><span id="deadlyaim_bonus_offcrit_physical_fix"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <th colspan="5">Melee</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="powerattack_active" /></td>
                                    <td><label for="powerattack_active">Power Attack</label></td>
                                    <td><div id="powerattack_slider"></div></td>
                                    <td id="powerattack_preview">-0/+0</td>
                                    <td class="hidey">
                                        <script>
                                            $("#powerattack_slider").slider({
                                                min: 0,
                                                max: 6,
                                                step: 1,
                                                slide: function(event, ui) {
                                                    let newval = ui.value;
                                                    $("#powerattack_preview").text("-"+newval+"/+"+newval*2);
                                                    if($("#power2h_active").prop('checked')) {
                                                        $("#powerattack_preview").text("-"+newval+"/+"+newval*3);
                                                    } else {
                                                        $("#powerattack_preview").text("-"+newval+"/+"+newval*2);
                                                    }
                                                },
                                                change: function(event, ui) {
                                                    let newval = ui.value;
                                                    $("#powerattack_preview").text("-"+newval+"/+"+newval*2);
                                                    if($("#power2h_active").prop('checked')) {
                                                        $("#powerattack_preview").text("-"+newval+"/+"+newval*3);
                                                    } else {
                                                        $("#powerattack_preview").text("-"+newval+"/+"+newval*2);
                                                    }
                                                    updateAll();
                                                }
                                            });
                                            function powerattack_update() {
                                                if ($("#powerattack_active").prop('checked')) {
                                                    let buffval = $("#powerattack_slider").slider("value")
                                                    $("#powerattack_AT").text("-"+buffval);
                                                    if($("#power2h_active").prop('checked')) {
                                                        buffval = buffval * 3;
                                                    } else {
                                                        buffval = buffval * 2;
                                                    }
                                                    $("#powerattack_bonus_main_physical_fix").text(buffval);
                                                    $("#powerattack_bonus_maincrit_physical_fix").text(buffval);
                                                    $("#powerattack_bonus_off_physical_fix").text(buffval);
                                                    $("#powerattack_bonus_offcrit_physical_fix").text(buffval);
                                                } else {
                                                    $("#powerattack_AT").text("0");
                                                    $("#powerattack_bonus_main_physical_fix").text("");
                                                    $("#powerattack_bonus_maincrit_physical_fix").text("");
                                                    $("#powerattack_bonus_off_physical_fix").text("");
                                                    $("#powerattack_bonus_offcrit_physical_fix").text("");
                                                    
                                                    $("#power2h_active").prop('checked', false);
                                                }
                                            };
                                        </script>
                                        <span id="powerattack_AT"></span><span id="powerattack_bonus_main_physical_fix"></span><span id="powerattack_bonus_maincrit_physical_fix"></span><span id="powerattack_bonus_off_physical_fix"></span><span id="powerattack_bonus_offcrit_physical_fix"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="power2h_active" /></td>
                                    <td><label for="power2h_active">Power Attack Two-Handed</label></td>
                                    <td>Main hand weapon is two-handed for the purpose of Power Attack</td>
                                    <td id="power2h_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function power2h_update() {
                                                if ($("#power2h_active").prop('checked')) {
                                                    $("#power2h_POWER2H").text("1");
                                                } else {
                                                    $("#power2h_POWER2H").text("0");
                                                }
                                                powerattack_update();
                                            }
                                        </script>
                                        <span id="power2h_POWER2H">0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="fightdef_active" /></td>
                                    <td><label for="fightdef_active">Fight defensivly</label></td>
                                    <td>For -4 AT, gain +2 AC (dodge)</td>
                                    <td id="fightdef_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function fightdef_update() {
                                                if ($("#fightdef_active").prop('checked')) {
                                                    $("#fightdef_AT").text("-4");
                                                    
                                                } else {
                                                    $("#fightdef_AT").text("0");
                                                    
                                                }                                            
                                            }
                                        </script>
                                        <span id="fightdef_AT">0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="combatexpert_active" /></td>
                                    <td><label for="combatexpert_active">Combat Expertise (-x AT/+x AC)</label></td>
                                    <td><div id="combatexpert_slider"></div></td>
                                    <td id="combatexpert_preview">-0/+0</td>
                                    <td class="hidey">
                                        <script>
                                            $("#combatexpert_slider").slider({
                                                min: 0,
                                                max: 6,
                                                step: 1,
                                                slide: function(event, ui) {
                                                    $("#combatexpert_preview").text("-"+ui.value+"/+"+ui.value);
                                                },
                                                change: function(event, ui) {
                                                    updateAll();
                                                }
                                            });
                                            function combatexpert_update() {
                                                if ($("#combatexpert_active").prop('checked')) {
                                                    let buffval = $("#combatexpert_slider").slider("value")
                                                    $("#combatexpert_AT").text("-"+buffval);
                                                    
                                                } else {
                                                    $("#combatexpert_AT").text("0");
                                                    
                                                }
                                            };
                                        </script>
                                        <span id="combatexpert_AT">0</span>
                                    </td>
                                </tr>

                                <tr>
                                    <th colspan="5">Debuffs</th>
                                </tr>

                                <tr>
                                    <td><input type="checkbox" id="sickened_active" /></td>
                                    <td><label for="sickened_active">Sickened</label></td>
                                    <td>-2 to AT, DMG, Saves, Skills, Ability-Checks</td>
                                    <td id="sickened_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function sickened_update() {
                                                if ($("#sickened_active").prop('checked')) {
                                                    $("#sickened_AT").text("-2");
                                                    $("#sickened_bonus_main_physical_fix").text("-2");
                                                    $("#sickened_bonus_maincrit_physical_fix").text("-2");
                                                    $("#sickened_bonus_off_physical_fix").text("-2");
                                                    $("#sickened_bonus_offcrit_physical_fix").text("-2");
                                                    
                                                } else {
                                                    $("#sickened_AT").text("0");
                                                    $("#sickened_bonus_main_physical_fix").text("");
                                                    $("#sickened_bonus_maincrit_physical_fix").text("");
                                                    $("#sickened_bonus_off_physical_fix").text("");
                                                    $("#sickened_bonus_offcrit_physical_fix").text("");
                                                }                                            
                                            }
                                        </script>
                                        <span id="sickened_AT">0</span>
                                    </td>
                                </tr>  
                                
                                <tr>
                                    <td><input type="checkbox" id="shaken_active" /></td>
                                    <td><label for="shaken_active">Shaken</label></td>
                                    <td>-2 to AT, Saves, Skills, Ability-Checks</td>
                                    <td id="shaken_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function shaken_update() {
                                                if ($("#shaken_active").prop('checked')) {
                                                    $("#shaken_AT").text("-2");
                                                    
                                                } else {
                                                    $("#shaken_AT").text("0");
                                                    
                                                }                                            
                                            }
                                        </script>
                                        <span id="shaken_AT">0</span>
                                    </td>
                                </tr>

                                <tr>
                                    <td><input type="checkbox" id="dazzled_active" /></td>
                                    <td><label for="dazzled_active">Dazzled</label></td>
                                    <td>-1 AT, Perception</td>
                                    <td id="dazzled_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function dazzled_update() {
                                                if ($("#dazzled_active").prop('checked')) {
                                                    $("#dazzled_AT").text("-1");
                                                    
                                                } else {
                                                    $("#dazzled_AT").text("0");
                                                    
                                                }                                            
                                            }
                                        </script>
                                        <span id="shaken_AT">0</span>
                                    </td>
                                </tr>

                                <tr>
                                    <th colspan="5">Extra modifiers (if needed)</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="atoffset_active" /></td>
                                    <td><label for="atoffset_active">AT Offset</label></td>
                                    <td><input type="number" id="atoffset_input" /></td>
                                    <td id="atoffset_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function atoffset_update() {
                                                if ($("#atoffset_active").prop('checked')) {
                                                    let newval = $("#atoffset_input").prop("value");
                                                    if(newval == "") {
                                                        newval = "0";
                                                    }
                                                    $("#atoffset_AT").text(newval);
                                                } else {
                                                    $("#atoffset_AT").text("0");
                                                }                                            
                                            }
                                            $("#atoffset_input").bind('keyup change click', function(e) {
                                                updateAll();
                                            })
                                        </script>
                                        <span id="atoffset_AT">0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="extraatoffset_active" /></td>
                                    <td><label for="extraatoffset_active">Extra Attacks at full BAB</label></td>
                                    <td><input type="number" id="extraatoffset_input" /></td>
                                    <td id="extraatoffset_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function extraatoffset_update() {
                                                if ($("#extraatoffset_active").prop('checked')) {
                                                    let newval = $("#extraatoffset_input").prop("value");
                                                    if(newval == "") {
                                                        newval = "0";
                                                    }
                                                    $("#extraatoffset_EXTRAAT").text(newval);
                                                } else {
                                                    $("#extraatoffset_EXTRAAT").text("0");
                                                }                                            
                                            }
                                            $("#extraatoffset_input").bind('keyup change click', function(e) {
                                                updateAll();
                                            })
                                        </script>
                                        <span id="extraatoffset_EXTRAAT">0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" id="dmgoffset_active" /></td>
                                    <td><label for="dmgoffset_active">Damage Offset</label></td>
                                    <td><input type="number" id="dmgoffset_input" /></td>
                                    <td id="dmgoffset_preview">&nbsp;</td>
                                    <td class="hidey">
                                        <script>
                                            function dmgoffset_update() {
                                                if ($("#dmgoffset_active").prop('checked')) {
                                                    let newval = $("#dmgoffset_input").prop("value");
                                                    if(newval == "") {
                                                        newval = "0";
                                                    }
                                                    $("#dmgoffset_bonus_main_physical_fix").text(newval);
                                                    $("#dmgoffset_bonus_maincrit_physical_fix").text(newval);
                                                    $("#dmgoffset_bonus_off_physical_fix").text(newval);
                                                    $("#dmgoffset_bonus_offcrit_physical_fix").text(newval);
                                                } else {
                                                    $("#dmgoffset_bonus_main_physical_fix").text("");
                                                    $("#dmgoffset_bonus_maincrit_physical_fix").text("");
                                                    $("#dmgoffset_bonus_off_physical_fix").text("");
                                                    $("#dmgoffset_bonus_offcrit_physical_fix").text("");
                                                }                                            
                                            }
                                            $("#dmgoffset_input").bind('keyup change click', function(e) {
                                                updateAll();
                                            })
                                        </script>
                                        <span id="dmgoffset_bonus_main_physical_fix"></span><span id="dmgoffset_bonus_maincrit_physical_fix"></span><span id="dmgoffset_bonus_off_physical_fix"></span><span id="dmgoffset_bonus_offcrit_physical_fix"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <script>
                            function updateAll() {
                                $("input[id$='_active']").each(function(n, el) {
                                    //console.log(el);
                                    let idname = $(el).attr("id");
                                    //console.log(idname);
                                    let newname = idname.split("_")[0] + "_update";
                                    window[newname]();
                                });
                            }
                            $("input[id$='_active']").change(updateAll);
                            updateAll();
                            //$("#roundmods input[type='checkbox']").checkboxradio();
                            $("table#roundmods tbody tr td:nth-child(3)").addClass("parameters");
                            
                        </script>
                    <!--</div>
                </div>-->
            </div>
            <div id="resolvetab">
                <table id="resolvemods" class="fullwidth">
                    <tbody>
                        <tr>
                            <td class="expand"></td><th class="shrink rightaligned">Attack-Mods:</th><th class="shrink leftaligned" id="resolvemods_atmods"></th><td class="expand"></td><th class="shrink rightaligned">Extra-Attacks:</th><th class="shrink leftaligned" id="resolvemods_extras"></th><td class="expand"></td>
                        </tr>
                    </tbody>
                </table>
                <br />
                <table class="fullwidth" id="resolvetable">
                    <thead>
                        <tr>
                            <th>Attack-Nr.</th><td></td><th>✔</th><th colspan="3">Attack</th><td></td><th>✔</th><th colspan="3">Crit</th><td></td>
                        </tr>
                    </thead>
                    <tbody id="resolverows">
                    </tbody>
                </table>
                <script>
                    function rollall() {
                        wassingleattack = false;
                        roll(false);
                    }
                    function roll(onlyone = false) {
                        let attackmods = getAllOfModifier("_AT");
                        let totalattackmods = sumOfArray(attackmods);
                        
                        let extraATs = getAllOfModifier("_EXTRAAT");
                        let totalextraATs = sumOfArray(extraATs);
                        $("#resolvemods_extras").text(totalextraATs);
                        let atmods_text = ""
                        let filteredatmods = filterArray(attackmods, "0");
                        for(let attackmod of filteredatmods) {
                            if(parseFloat(attackmod) > 0) {
                                atmods_text += "+" + attackmod + ", ";
                            } else {
                                atmods_text += attackmod + ", ";
                            }
                        }
                        atmods_text = atmods_text.substring(0, atmods_text.length - 2);
                        atmods_text += " = " + totalattackmods;
                        $("#resolvemods_atmods").text(atmods_text);
                        //let MANYSHOT = sumOfArray(getAllOfType("_MANYSHOT"));
                        
                        $("#maintabs").tabs({active: 2});
                        clearattacks();
                        let mainbonus = $("#mainattackchain").val().split(",");
                        let offbonus = $("#offattackchain").val().split(",");
                        let biggestBAB = Math.max(...mainbonus);
                        if(onlyone) {
                            mainbonus = [biggestBAB];
                            offbonus = "";
                        }
                        let critbonus = $("#critbonus").val();
                        if(critbonus == "") {
                            critbonus = 0;
                        } else {
                            critbonus = parseFloat(critbonus);
                        }
                        
                        let ibonus = 0;
                        for(let bonus of mainbonus) {
                            let totalbonus = parseFloat(bonus) + parseFloat(totalattackmods);
                            addattack(["main"+ibonus, "Main "+(ibonus+1)], parseFloat(totalbonus), parseFloat(totalbonus)+critbonus);
                            let iibonus = 0;
                            if(ibonus == 0 && !onlyone) {
                                for(let i=0; i<totalextraATs; i++) {
                                    totalextrabonus = biggestBAB + totalattackmods;
                                    addattack(["extra"+iibonus, "Extra "+(iibonus+1)], parseFloat(totalextrabonus), parseFloat(totalextrabonus)+critbonus);
                                    iibonus += 1;
                                }
                            }
                            
                            ibonus += 1;
                        }
                        ibonus = 0;
                        if(offbonus != "") {
                            for(let bonus of offbonus) {
                                let totalbonus = parseFloat(bonus) + parseFloat(totalattackmods);
                                addattack(["off"+ibonus, "Off "+(ibonus+1)], parseFloat(totalbonus), parseFloat(totalbonus)+critbonus);
                                ibonus += 1;
                            }
                        }
                        recolor();
                        updateLayout();
                    }
                    function rollone() {
                        //$("#maintabs").tabs({active: 2});
                        wassingleattack = true;
                        roll(true);
                    }
                    function recolor() {
                        let atrolls = getAllOfModifier("_result").map(Number);
                        let maxroll = Math.max(...atrolls);
                        let minroll = Math.min(...atrolls);
                        $("span[id*='_result']").each(function(i, obj) {
                            let currentval = parseInt(obj.innerHTML);
                            let pct = (currentval-minroll) / (maxroll - minroll);
                            let newcolor = colorscale(greencolor, redcolor, pct);
                            $(this).css("color", "rgb("+newcolor[0]+", "+newcolor[1]+", "+newcolor[2]+")");
                        })
                    }
                    function clearattacks() {
                        $("#resolverows").empty();
                    }
                    function addattack(attackid, modifier, critmodifier, critrange=20) {
 
                        let newrow = '<tr id="' + attackid[0] + '">';
                            newrow += '<th>' + attackid[1] + '</th>';
                        newrow += '<td class="expand"></td>';
                        newrow += '<td class="shrink"><label for="' + attackid[0] + '_tohit">&nbsp;</label><input type="checkbox" id="' + attackid[0] + '_tohit" /></td>';
                        newrow += '<td class="shrink"><select id="' + attackid[0] + '_tohitdice">' + d20selector + '</select></td>';
                        newrow += '<td class="shrink">+<span id="' + attackid[0] + '_modifier">' + modifier + '</span></td>';
                        newrow += '<td class="shrink">=<span id="' + attackid[0] + '_result" class="diceresult">0</span></td>';
                        newrow += '<td class="expand"><div id="' + attackid[0] + '_critthreat" class="critting"></span></td>';
                        newrow += '<td class="shrink"><label for="' + attackid[0] + '_tocrit">&nbsp;</label><input type="checkbox" id="' + attackid[0] + '_tocrit" /></td>';
                        newrow += '<td class="shrink"><select id="'+attackid[0]+'_tocritdice">'+d20selector+'</select></td>';
                        newrow += '<td class="shrink">+<span id="' + attackid[0] + '_critmodifier">' + critmodifier + '</span></td>';
                        newrow += '<td class="shrink">=<span id="' + attackid[0] + '_critresult" class="diceresult">0</td>';
                        newrow += '<td class="expand"></td>';
                        $("#resolverows").append($(newrow));
                        /*$("#" + attackid[0] + '_tohitdice option').each(function() {
                            if($(this).val() >= critrange) {
                                $(this).addClass("incritrange");
                            }
                        });*/
                        $("#" + attackid[0] + '_tohitdice').selectmenu({
                            change: function(a,b) {
                                $(this).trigger("change");
                                recolor();
                            }
                        }).selectmenu("menuWidget").addClass("overflow");
                        $("#" + attackid[0] + '_tocritdice').selectmenu({
                            change: function(a,b) {
                                $(this).trigger("change");
                                recolor();
                            }
                        }).selectmenu("menuWidget").addClass("overflow");
                        $("#" + attackid[0] + '_tohitdice').change(function() {
                            let nval = $(this).val();
                            let nmod = $("#" + attackid[0] + '_modifier').text();
                            $("#" + attackid[0] + '_result').text(parseFloat(nval)+parseFloat(nmod));
                            let threaten = false;
                            if(attackid[0].substring(0, 3) == "off") {
                                if(nval >= $("#offcritroll").slider("option", "value")) {
                                    threaten = true;
                                }
                            } else {
                                if(nval >= $("#maincritroll").slider("option", "value")) {
                                    threaten = true;
                                }
                            }
                            
                            $("#" + attackid[0] + '_critthreat').text(threaten ? "CRIT THREAT": "");
                            
                        });
                        $("#" + attackid[0] + '_tocritdice').change(function() {
                            let nval = $(this).val();
                            let nmod = $("#" + attackid[0] + '_critmodifier').text();
                            $("#" + attackid[0] + '_critresult').text(parseFloat(nval)+parseFloat(nmod));
                        });
                        //$("#" + attackid[0]+" input[type='checkbox']").checkboxradio({
                        //    icon: false
                        //});
                        
                        if(modifier > 250) {
                            $("#" + attackid[0] + '_tohit').prop("checked", true);
                        }

                        if(autodiceroll) {
                            let hitnumber = randomdicenumber(20);
                            //$("#" + + attackid[0] + '_tohit').prop("checked", false).checkboxradio('refresh');
                            if(hitnumber == 20) {
                                //console.log(attackid[0] + '_tohit rolled a 20!');
                                $("#" + attackid[0] + '_tohit').prop("checked", true);
                                //$("#" + + attackid[0] + '_tohit').prop("checked", true).change();
                            }
                            let critnumber = randomdicenumber(20);
                            $("#" + attackid[0] + '_tohitdice').val(hitnumber).trigger("change");
                            $("#" + attackid[0] + '_tohitdice').selectmenu("refresh");
                            //$("#" + attackid[0] + '_tohitdice').
                            $("#" + attackid[0] + '_tocritdice').val(critnumber).trigger("change");
                            $("#" + attackid[0] + '_tocritdice').selectmenu("refresh");
                        }
                    }
                </script>
            </div>
            <div id="resulttab">
                <h3>Results</h3>
                <div id="resultcontainer">
                    
                    
                </div>
                <br /><br /><br />
                
                <div class="semiaccordion" id="huliresults">
                    <h3>Results for Discord</h3>
                    <div>
                        <textarea id="discordoutput" class="discordoutput" cols="200" rows="10" disabled></textarea>
                        <button onclick="copydiscordoutput();" class="fullwidth">Copy to clipboard</button>
                    </div>
                </div>
                <script>
                    function copydiscordoutput() {
                        let outtext = $("#discordoutput").val();
                        navigator.clipboard.writeText(outtext).then(function() {
                            $("#discordoutput").css("border-color", "lightgreen").animate({"border-color": "black"}, 2000);
                        }, function(err) {
                            $("#discordoutput").css("border-color", "red").animate({"border-color": "black"}, 2000);
                        })
                    }
                    function resolveattacks() {
                        // RESOLVE ATTACKS
                        $("#resultcontainer").empty();
                        let resulttable = '<table class="resulttable fullwidth">';
                        let relevanttypes = [];
                        let alltypeconcat = damagetypes_full.concat(damagetypes_dice, damagetypes_fix, damagetypes_hidden_dice, damagetypes_hidden_fix);
                        for(let dtype of alltypeconcat) {
                            if(relevanttypes.includes(dtype)) {
                                continue;
                            }
                            if(filterArray(getAllOfDamage("_" + dtype + "_"), "").length == 0) {
                                //console.log("skipped dtype "+dtype);
                                continue;
                            }
                            //console.log("added dtype "+dtype + " with entries:")
                            //console.log(filterArray(getAllOfDamage("_" + dtype + "_"), ""));
                            relevanttypes.push(dtype);
                        }
                        console.log("relevanttypes", relevanttypes);
                        resulttable += "<thead><tr><th colspan='2'></th>";
                        for(let dtype of relevanttypes) {
                            resulttable += "<th>" + damagetype_aliases[dtype] + "</th>";
                        }
                        resulttable += "<th>SUM</th></tr></thead>";
                        resulttable += "<tbody>";
                        alldmg = {};
                        atnr = -1;
                        $("tbody#resolverows tr").each(function() {
                            let attackid = $(this).attr("id");
                            let ismainhand = attackid.substring(0,3) != "off";
                            let hits = $("#"+attackid+"_tohit").is(":checked");
                            let crits = $("#"+attackid+"_tocrit").is(":checked");
                            //console.log(attackid, ismainhand, hits, crits);
                            if(!hits) {
                                return;
                            }
                            atnr += 1;
                            //console.log(attackid+" hits!");
                            let hitemote = emotes.normal;
                            if($("#manyshot_MANYSHOT").text() == "1" && attackid == "main0") {
                                //console.log("Manyshot hits!");
                                hitemote = emotes.manyshot;
                            }
                            if(crits) {
                                hitemote += emotes.critical;
                            }
                            //resolve damages
                            damage = {total: 0};
                            for(let dtype of relevanttypes) {
                                damage[dtype] = {
                                    total: 0, 
                                    singles: [], 
                                    vocal: []
                                };
                                //console.log(dtype);
                                let query = ismainhand ? "main_" : "off_";
                                query += dtype
                                let alldice = filterArray(getAllOfDamage(query+"_dice"), "");
                                let allfix = filterArray(getAllOfDamage(query+"_fix"), "");
                                if(dtype == "hammerthegap") {
                                    allfix = [atnr];
                                }
                                if($("#manyshot_MANYSHOT").text() == "1" && attackid == "main0" && !wassingleattack) {
                                    if(dtype != "precision") {
                                        //console.log("manyshot", alldice, dtype);
                                        alldice = alldice.concat(alldice);
                                        allfix = allfix.concat(allfix);
                                    } else {
                                        console.log("no manyshot for precision");
                                    }

                                }
                                if(crits) {
                                    let critquery = ismainhand ? "maincrit_" : "offcrit_";
                                    critquery += dtype;
                                    alldice = alldice.concat(filterArray(getAllOfDamage(critquery+"_dice"), ""));
                                    allfix = allfix.concat(filterArray(getSetupDamage(critquery+"_fix"), ""));
                                    console.log("htg?", dtype, allfix);
                                    let b = ismainhand ? "maincritmult" : "offcritmult";
                                    let a = filterArray(getModifyDamage(critquery+"_fix"), "");
                                    let ccritmult = $("#" + b).slider("value");
                                    let c = a.map(function(x) { return parseFloat(x) * ccritmult });
                                    allfix = allfix.concat(c);
                                    console.log("more", allfix);
                                }
                                //console.log(alldice, allfix);
                                damage[dtype].singles = allfix.map(Number);
                                damage[dtype].vocal = allfix.map(Number);
                                damage[dtype].total = sumOfArray(allfix);
                                for(let diceroll of alldice) {
                                    let newdice = rolldice(diceroll);
                                    if(dtype == "precision" && $("#sneak2bonus_SNEAKTWO").text() == "1" && $("#sneak3bonus_SNEAKTHREE").text() == "1") {
                                        for(let i = 0; i < newdice.length; i++) {
                                            if(newdice[i] < 3) {
                                                newdice[i] = 3;
                                            }
                                        }
                                    } else if(dtype == "precision" && $("#sneak2bonus_SNEAKTWO").text() == "1") {
                                        for(let i = 0; i < newdice.length; i++) {
                                            if(newdice[i] < 2) {
                                                newdice[i] = 2;
                                            }
                                        }
                                    }
                                    damage[dtype].singles.push(newdice);
                                    damage[dtype].vocal.push(diceroll);
                                    damage[dtype].total += sumOfArray(newdice);
                                }
                                damage.total += damage[dtype].total;
                            }
                            //console.log("alldmg", damage);
                            alldmg[attackid] = damage;
                            hitemote += damagebasedemotes(damage.total);
                            resulttable += "<tr>";
                            resulttable += "<td>" + hitemote + "</td><th>" + $("#"+attackid+" th").text() + " (🗡" + $("#" + attackid + "_result").text() + ")</th>"
                            for(let dtype of relevanttypes) {
                                let verbs = verboseDamageString(damage[dtype].singles, damage[dtype].vocal);
                                //console.log(verbs);
                                resulttable += '<td title="' + verbs + '">'+damagebasedemotes(damage[dtype].total, true, factor=0.5)+"&nbsp;"+damagetype_emotes[dtype]+'<span id="">'+damage[dtype].total+'</span></td>'
                            }
                            resulttable += '<td>' + damage.total + '</td>'
                            resulttable += "</tr>";
                        });
                        console.log(alldmg);
                        let alltotals = {};
                        let all = 0;
                        for(let dtype of relevanttypes) {
                            let counter = 0;
                            for (const [key, vvv] of Object.entries(alldmg)) {
                                counter += vvv[dtype].total;
                            }
                            alltotals[dtype] = counter;
                            all += counter;
                        }
                        resulttable += "</tbody>";
                        resulttable += '<tbody id="resulttotals">';
                        resulttable += '<td></td><th>SUM</th>';
                        for (let dtype of relevanttypes) {
                            resulttable += '<th>' + alltotals[dtype] + '</th>';
                        }
                        resulttable += '<th>' + damagebasedemotes(all, false, factor=2) + ' ' + all + '</th>';
                        resulttable += '</tbody>';
                        resulttable += '</table>';
                        $("#resultcontainer").append($(resulttable));
                        $("#resultcontainer").tooltip();
                        let discordout = "";
                        if(wassingleattack) {
                            discordout += "single attack\n";
                        } else {
                            discordout += "normal attack round\n";
                        }
                        discordout += "```\n";
                        for (const [key1, vvv1] of Object.entries(alldmg)) {
                            for (const [key2, vvv2] of Object.entries(vvv1)) {
                                if(key2 == "total") {
                                    continue;
                                }
                                if(vvv2.total == 0) {
                                    continue;
                                }
                                //console.log(key1, vvv1, key2, vvv2);
                                let dtypename = damagetype_aliases[key2];
                                //console.log(dtypename);
                                let dtypelower = dtypename.toLowerCase();
                                //console.log(dtypelower);
                                discordout += vvv2.total + " " + dtypelower + " + ";
                            }
                            discordout = discordout.substring(0, discordout.length-2) + "damage\n";
                        }
                        discordout += "\n```";
                        $("#discordoutput").val(discordout);
                        $("#maintabs").tabs({active: 3});
                        updateLayout();
                    }
                    function resetresolver() {
                        $("#maintabs").tabs({active: 1});
                        updateLayout();
                    }
                </script>
            </div>
        </div>
    </div>
    <div class="buttoncontainer">
        <button id="reset_bottom" onClick="resetresolver();" style="flex-grow: 20;">New Round</button>
        <button id="rollall_bottom" onClick="rollall();" style="flex-grow: 35;">Attack</button>
        <button id="rollone_bottom" onClick="rollone();" style="flex-grow: 15;">Attack<br />Once</button>
        <button id="resolve_bottom" onClick="resolveattacks();"  style="flex-grow: 20;">Damage</button>
    </div>
    <div class="sidebuttoncontainer">
        <button id="reset_side" onClick="resetresolver();" style="flex-grow: 20;">New<br />Round</button>
        <button id="rollall_side" onClick="rollall();" style="flex-grow: 35;">Attack</button>
        <button id="rollone_side" onClick="rollone();" style="flex-grow: 15;">Attack<br />Once</button>
        <button id="resolve_side" onClick="resolveattacks();"  style="flex-grow: 20;">Damage</button>
    </div>
    <script>
        //dynamic addition of elements
        function addAllButtons() {
            for(let pfile of presetfiles) {
                let pfilename = pfile.split(".")[0];
                if(!(pfilename in presets)) {
                    console.log("missing preset: ", pfilename);
                    return;
                }
            }
            if(buttonsareloaded) {
                console.log("buttons already there!");
                return;
            }
            console.log("found all presets!")
            for (const [key, preset] of Object.entries(presets)) {
                //console.log(preset.name)
                var r = $('<button class="quarterwidth" onClick="loadpreset(\''+key+'\');">'+preset.name+'</button>')
                $("#presetcontainer").append(r)
            }
            $('#presetcontainer button').button();
            updateLayout();
        }
        addAllButtons();
        //init ui components
        $(document).ready(function() {
            $("button").button();
            $("#damagesetup").transpose({mode: 0});
            $(".semiaccordion").accordion({
                collapsible: true
            })
            $(".normalaccordion").accordion({
                collapsible: false
            })
            $("#huliresults").accordion({
                active: false,
                clearStyle: true,
                heightStyle: "content"
            })
            $("#maintabs").tabs({
                heightStyle: "fill",
                show: "slide",
                activate: function() {
                    updateLayout();
                }
            });
            //restyle normal inputs
            $('input').addClass("ui-widget ui-widget-content ui-corner-all");
            loadpreset(defaultload);
            updateLayout();
        });
        function updateLayout() {
            let vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
            let vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
            let damagetabletransposed = $("#damagesetup").has('tbody tr[id^="tp_row_"]');
            if(vw > vh) {
                //landscape/horizontal
                $(".tabcontainer").removeClass("tabbuttonsbottom");
                $(".tabcontainer").addClass("tabbuttonsright");
                $(".sidebuttoncontainer").removeClass("hidediv");
                $(".buttoncontainer").addClass("hidediv")
                
                if(damagetabletransposed.length > 0) {
                    $("#damagesetup").transpose("reset");
                }
            } else {
                //portrait/vertical
                $(".tabcontainer").removeClass("tabbuttonsright");
                $(".tabcontainer").addClass("tabbuttonsbottom");
                $(".buttoncontainer").removeClass("hidediv");
                $(".sidebuttoncontainer").addClass("hidediv")
                if(damagetabletransposed.length == 0) {
                    $("#damagesetup").transpose("transpose");
                }
            }
            $("#huliresults").accordion("refresh");
            $(".semiaccordion").accordion("refresh");
            $(".normalaccordion").accordion("refresh");
    
            $("#maintabs").tabs("refresh");
            $("#huliresults").accordion("refresh");
            $(".semiaccordion").accordion("refresh");
            $(".normalaccordion").accordion("refresh");
        }
        $(window).resize(function() {
            //console.log("viewport changed!");
            updateLayout();
        });
    </script>
    <div class="versionnumber">0.5c beta</div>
</body>
</html>
